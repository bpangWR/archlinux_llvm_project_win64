pkgname=llvm-project
pkgver=10.0.1
pkgrel=1
pkgdesc="C language family frontend for LLVM"
arch=('x86_64')
url="https://clang.llvm.org/"
license=('custom:Apache 2.0 with LLVM Exception')
depends=('mingw-w64-gcc')
makedepends=('cmake' 'make')

_source_base=https://github.com/llvm/llvm-project/releases/download/llvmorg-10.0.1
source=($_source_base/$pkgname-$pkgver.tar.xz{,.sig})

prepare() {
    cd "$srcdir/$pkgname-$pkgver"
    mkdir -p build
}

build() {
    cd "$srcdir/$pkgname-$pkgver/build"
    set -x
    local cmake_args=(
	-DCMAKE_C_COMPILER=/usr/bin/x86_64-w64-mingw32-gcc
	-DCMAKE_CXX_COMPILER=/usr/bin/x86_64-w64-mingw32-g++
	-DCMAKE_SYSTEM_NAME=Windows
	-DCMAKE_RC_COMPILER=/usr/bin/x86_64-w64-mingw32-windres
	-DCMAKE_BUILD_TYPE=Release
	-DLLVM_ENABLE_PROJECTS=clang
	-DCROSS_TOOLCHAIN_FLAGS_NATIVE=/build/native.cmake
    )
    echo $SHELL
    #    cmake ../llvm "${cmake_args[@]}"
    unset LDFLAGS CFLAGS CXXFLAGS CHOST CPPFLAGS COMMAND_MODE
    printenv > /build/clang_win10/env.2
    /build/x.sh
    make -j4
}

check() {
    cd "$srcdir/$pkgname-$pkgver/build"
    ls -l bin/clang.exe
}

package() {
    cd "$srcdir/$pkgname-$pkgver/build"
    DESTDIR="$pkgdir" make install-distribution
}
